{"EDITOR_STATE":{"allProjectFiles":{"03d89a53-61d4-457f-af7c-c2d22e13d493":{"id":"03d89a53-61d4-457f-af7c-c2d22e13d493","parent":null,"name":"DemoSwaggerDataEndpoint","type":"DIRECTORY","isDirectory":true,"children":["71976776-5fe3-4e2f-966b-6de6dc8b8b79"],"isRemovable":false,"filePath":"DemoSwaggerDataEndpoint"},"71976776-5fe3-4e2f-966b-6de6dc8b8b79":{"id":"71976776-5fe3-4e2f-966b-6de6dc8b8b79","parent":"03d89a53-61d4-457f-af7c-c2d22e13d493","name":"addAPI.js","type":"LAMBDA_FILE","isDirectory":false,"children":[],"isRemovable":true,"filePath":"DemoSwaggerDataEndpoint/addAPI.js","code":"let AWS = require('aws-sdk');\nconst ddb = new AWS.DynamoDB.DocumentClient();\nlet SwaggerParser = require(\"swagger-parser\");\n\nexports.handler = function (event, context, callback) {\n\n    // console.log(event);\n\n    let swaggerDef = event.body;\n    console.log(swaggerDef);\n\n    SwaggerParser.validate(swaggerDef)\n        .then(validatedSpec => {\n            console.log(\"Validated API definition\", swaggerDef);\n\n            let apiName = swaggerDef['info']['title'];\n            let apiVersion = swaggerDef['info']['version'];\n            console.log(\"API details\", apiName, apiVersion);\n\n            ddb.put({\n                TableName: 'SwaggerDetails',\n                Item: { 'apiName': apiName, 'apiVersion': apiVersion, 'definition': swaggerDef }\n            }).promise()\n                .then((data) => {\n                    console.log(\"Successfully added API definition to DB\", data);\n                    callback(null, {\n                        \"isBase64Encoded\": true,\n                        \"statusCode\": 200,\n                        \"headers\": {\n                            \"headeAccess-Control-Allow-OriginrName\": \"*\"\n                        },\n                        \"body\": JSON.stringify({\n                            \"apiName\": apiName,\n                            \"apiVersion\": apiVersion\n                        })\n                    });\n\n                }).catch((err) => {\n                    console.log(\"Failed to add API definition to DB\", err);\n                    callback(err);\n                });\n\n        })\n        .catch((err) => {\n            console.log('Failed to validate API definition', swaggerDef, err);\n            callback(err);\n        });\n}","triggers":[{"resourceName":"apigusEast1SwaggerDataaddAPIpost","config":{}}],"config":{"memory":128,"timeout":60,"runtime":"nodejs8.10"}}},"deletedFiles":[],"rootNode":"03d89a53-61d4-457f-af7c-c2d22e13d493","openFiles":["71976776-5fe3-4e2f-966b-6de6dc8b8b79"],"currentFileId":"71976776-5fe3-4e2f-966b-6de6dc8b8b79","resources":{"apigusEast1SwaggerDataaddAPIpost":{"name":"apigusEast1SwaggerDataaddAPIpost","type":"API_GATEWAY","config":{"selectedRegion":"us-east-1","apiMode":0,"apiName":"SwaggerData","endpointType":"EDGE","resourceMode":0,"resourceName":"addAPI","resourcePath":"/addAPI","restMethod":"POST","proxyIntegration":true,"enableCORS":true,"stageMode":0,"stageName":"staging"},"globallyEditable":true},"ddbSwaggerDetails":{"name":"ddbSwaggerDetails","type":"DynamoDB","config":{"mode":0,"operation":"put","table":{"arn":"","name":"SwaggerDetails","partitionKey":"apiName","partitionKeyType":"S","hasSortKey":true,"sortKey":"apiVersion","sortKeyType":"S","mode":0},"parameters":{"Key":{},"Item":{"apiName":"@{apiName}","apiVersion":"@{apiVersion}","definition":"@{swaggerDef}"},"ExpressionAttributeValues":{}},"validator":{"validatableFields":{},"validity":true},"valid":true},"globallyEditable":false}},"envVariables":[{"lambdaId":"all","varKey":"SIGMA_AWS_ACC_ID","varValue":null,"shouldPersist":false,"displayOnly":false,"editable":false}],"packageJSON":{"dependencies":{"swagger-parser":{"name":"swagger-parser","version":"5.0.5"}}},"lambdaId":"71976776-5fe3-4e2f-966b-6de6dc8b8b79"},"PROJECT_META":{"projectName":"DemoSwaggerDataEndpoint","projectDescription":"","projectVersion":"1.0.0","projectRegion":"us-east-1","lastSave":1537869578332},"VCS_STATE":{"provider":"GitHub","repo":{"name":"DemoSwaggerDataEndpoint","url":"https://github.com/sigmaidetest/DemoSwaggerDataEndpoint"}}}