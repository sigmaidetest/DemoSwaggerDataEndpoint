{"EDITOR_STATE":{"allProjectFiles":{"03d89a53-61d4-457f-af7c-c2d22e13d493":{"id":"03d89a53-61d4-457f-af7c-c2d22e13d493","parent":null,"name":"DemoSwaggerDataEndpoint","type":"DIRECTORY","isDirectory":true,"children":["71976776-5fe3-4e2f-966b-6de6dc8b8b79","3c1f9477-bd06-4f99-bf99-3a618270f541","62ab9962-0a9a-47c3-8c19-84ddf1c72686"],"isRemovable":false,"filePath":"DemoSwaggerDataEndpoint"},"71976776-5fe3-4e2f-966b-6de6dc8b8b79":{"id":"71976776-5fe3-4e2f-966b-6de6dc8b8b79","parent":"03d89a53-61d4-457f-af7c-c2d22e13d493","name":"addAPI.js","type":"LAMBDA_FILE","isDirectory":false,"children":[],"isRemovable":true,"filePath":"DemoSwaggerDataEndpoint/addAPI.js","code":"let AWS = require('aws-sdk');\nconst ddb = new AWS.DynamoDB.DocumentClient();\nlet SwaggerParser = require(\"swagger-parser\");\n\nexports.handler = function (event, context, callback) {\n\n    // console.log(event);\n\n    let swaggerDef = event;\n    console.log(swaggerDef);\n\n    SwaggerParser.validate(swaggerDef)\n        .then(validatedSpec => {\n            console.log(\"Validated API definition\", swaggerDef);\n\n            let apiName = swaggerDef['info']['title'];\n            let apiVersion = swaggerDef['info']['version'];\n            console.log(\"API details\", apiName, apiVersion);\n\n            ddb.put({\n                TableName: 'SwaggerDetails',\n                Item: { 'apiName': apiName, 'apiVersion': apiVersion, 'definition': JSON.stringify(swaggerDef) }\n            }).promise()\n                .then((data) => {\n                    console.log(\"Successfully added API definition to DB\", data);\n                    callback(null, {\n                        \"apiName\": apiName,\n                        \"apiVersion\": apiVersion\n                    });\n\n                }).catch((err) => {\n                    console.log(\"Failed to add API definition to DB\", err);\n                    callback(err);\n                });\n\n        })\n        .catch((err) => {\n            console.log('Failed to validate API definition', swaggerDef, err);\n            callback(err);\n        });\n}","triggers":[{"resourceName":"apigusEast1SwaggerDataaddAPIpost","config":{}}],"config":{"memory":128,"timeout":60,"runtime":"nodejs8.10"}},"3c1f9477-bd06-4f99-bf99-3a618270f541":{"id":"3c1f9477-bd06-4f99-bf99-3a618270f541","parent":"03d89a53-61d4-457f-af7c-c2d22e13d493","name":"addUserAPI.js","type":"LAMBDA_FILE","isDirectory":false,"children":[],"isRemovable":true,"filePath":"DemoSwaggerDataEndpoint/addUserAPI.js","code":"let AWS = require('aws-sdk');\nconst ddb = new AWS.DynamoDB.DocumentClient();\n\nexports.handler = function (event, context, callback) {\n\n    let username = event.username;\n    let apiName = event.apiName;\n\n    console.log(\"Subscribing user for API\", username, apiName);\n\n    ddb.put({\n        TableName: 'UserSwaggerSubscriptions',\n        Item: { 'username': username, 'apiName': apiName }\n    }).promise()\n        .then((data) => {\n            console.log(\"Successfully added entry\", data);\n            callback(null, {\n                username: username,\n                apiName: apiName\n            });\n\n        }).catch((err) => {\n            console.log(\"Failed to add entry\", err);\n            callback(err);\n        });\n}","triggers":[{"resourceName":"apigusEast1SwaggerDataaddUserAPIpost","config":{}}],"config":{"memory":128,"timeout":60,"runtime":"nodejs8.10"}},"62ab9962-0a9a-47c3-8c19-84ddf1c72686":{"id":"62ab9962-0a9a-47c3-8c19-84ddf1c72686","parent":"03d89a53-61d4-457f-af7c-c2d22e13d493","name":"getUserAPIs.js","type":"LAMBDA_FILE","isDirectory":false,"children":[],"isRemovable":true,"filePath":"DemoSwaggerDataEndpoint/getUserAPIs.js","code":"let AWS = require('aws-sdk');\nconst ddb = new AWS.DynamoDB.DocumentClient();\n\nexports.handler = function (event, context, callback) {\n\n    let username = event['queryStringParameters']['username'];\n    console.log(\"Username\", username);\n\n    ddb.query({\n        TableName: 'UserSwaggerSubscriptions',\n        ExpressionAttributeValues: {\n            ':userName': username\n        },\n        KeyConditionExpression: 'username = :userName'\n    }).promise()\n        .then((data) => {\n            let items = data.Items;\n            console.log(\"Retrived items\", items);\n\n            let userAPIs = items.map(item => item['apiName']);\n            callback(null, {\n                \"isBase64Encoded\": true,\n                \"statusCode\": 200,\n                \"headers\": {\n                    \"Access-Control-Allow-Origin\": \"*\"\n                },\n                \"body\": JSON.stringify(userAPIs)\n            });\n\n        }).catch((err) => {\n            console.log(\"Error occurred while retriving data\", err);\n            callback(err);\n        });\n\n\n\n}","triggers":[{"resourceName":"apigusEast1SwaggerDatagetUserAPIsget","config":{}}],"config":{"memory":128,"timeout":60,"runtime":"nodejs8.10"},"testCases":{"04528424-7b4b-4f8f-8d3d-c7f15bdbeb26":{"id":"04528424-7b4b-4f8f-8d3d-c7f15bdbeb26","name":"Unnamed event","functionId":"62ab9962-0a9a-47c3-8c19-84ddf1c72686","event":"{\n    \"queryStringParameters\": {\n        \"username\": \"udith\"\n    }\n}"}}}},"deletedFiles":[],"rootNode":"03d89a53-61d4-457f-af7c-c2d22e13d493","openFiles":["71976776-5fe3-4e2f-966b-6de6dc8b8b79","3c1f9477-bd06-4f99-bf99-3a618270f541","62ab9962-0a9a-47c3-8c19-84ddf1c72686"],"currentFileId":"62ab9962-0a9a-47c3-8c19-84ddf1c72686","resources":{"apigusEast1SwaggerDataaddAPIpost":{"name":"apigusEast1SwaggerDataaddAPIpost","type":"API_GATEWAY","config":{"selectedRegion":"us-east-1","apiMode":0,"apiName":"SwaggerData","endpointType":"EDGE","resourceMode":0,"resourceName":"addAPI","resourcePath":"/addAPI","restMethod":"POST","proxyIntegration":false,"enableCORS":true,"stageMode":0,"stageName":"staging"},"globallyEditable":true},"ddbSwaggerDetails":{"name":"ddbSwaggerDetails","type":"DynamoDB","config":{"mode":0,"operation":"put","table":{"arn":"","name":"SwaggerDetails","partitionKey":"apiName","partitionKeyType":"S","hasSortKey":true,"sortKey":"apiVersion","sortKeyType":"S","mode":0},"parameters":{"Key":{},"Item":{"apiName":"@{apiName}","apiVersion":"@{apiVersion}","definition":"@{swaggerDef}"},"ExpressionAttributeValues":{}},"validator":{"validatableFields":{},"validity":true},"valid":true},"globallyEditable":false},"apigusEast1SwaggerDataaddUserAPIpost":{"name":"apigusEast1SwaggerDataaddUserAPIpost","type":"API_GATEWAY","config":{"selectedRegion":"us-east-1","apiMode":0,"apiName":"SwaggerData","endpointType":"EDGE","resourceMode":0,"resourceName":"addUserAPI","resourcePath":"/addUserAPI","restMethod":"POST","proxyIntegration":false,"enableCORS":true,"stageMode":0,"stageName":"staging"},"globallyEditable":true},"ddbUserSwaggerSubscriptions":{"name":"ddbUserSwaggerSubscriptions","type":"DynamoDB","config":{"mode":0,"operation":"query","table":{"arn":"","name":"UserSwaggerSubscriptions","partitionKey":"username","partitionKeyType":"S","hasSortKey":true,"sortKey":"apiName","sortKeyType":"S","mode":0},"parameters":{"TableName":"UserSwaggerSubscriptions","ExpressionAttributeValues":{":userName":"@{username}"},"KeyConditionExpression":"username = :"},"validator":{"validatableFields":{},"validity":true},"valid":true},"globallyEditable":false},"apigusEast1SwaggerDatagetUserAPIsget":{"name":"apigusEast1SwaggerDatagetUserAPIsget","type":"API_GATEWAY","config":{"selectedRegion":"us-east-1","apiMode":0,"apiName":"SwaggerData","apiId":"4ka7gfcn6k","endpointType":"EDGE","rootResourceId":"w67la42h1g","existingResources":{"/addAPI":"43aygv","/addUserAPI":"sfa3q7","/":"w67la42h1g"},"resourceMode":0,"resourceName":"getUserAPIs","resourcePath":"/getUserAPIs","restMethod":"GET","proxyIntegration":true,"enableCORS":false,"stageMode":0,"stageName":"staging","stageDeploymentId":"4g54b3"},"globallyEditable":true}},"envVariables":[{"lambdaId":"all","varKey":"SIGMA_AWS_ACC_ID","varValue":null,"shouldPersist":false,"displayOnly":false,"editable":false}],"packageJSON":{"dependencies":{"swagger-parser":{"name":"swagger-parser","version":"5.0.5"}}},"lambdaId":"71976776-5fe3-4e2f-966b-6de6dc8b8b79"},"PROJECT_META":{"projectName":"DemoSwaggerDataEndpoint","projectDescription":"","projectVersion":"1.0.0","projectRegion":"us-east-1","lastSave":1538022123486},"VCS_STATE":{"provider":"GitHub","repo":{"name":"DemoSwaggerDataEndpoint","url":"https://github.com/sigmaidetest/DemoSwaggerDataEndpoint"}}}